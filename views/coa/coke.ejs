<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>COA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
    <style>
      /* ///////////////////////////////////////////////////////////////////////////////////// */
      #coa {
        transform: scale(0.92);
        transform-origin: center;
        border: 2px solid black;
        
      }
      .desc p{
        font-size: 0.75rem;
      }
      .desc{
        border-left: 1px solid black;
        border-right: 1px solid black;
      }
      .spec-table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        font-size: 10pt;
      }

      .spec-table th,
      .spec-table td {
        border: 1px solid #333;
        padding: 4px;
        text-align: left;
        word-wrap: break-word;
        
      }

      .spec-table th {
        font-weight: bold;
      }

      /* ///////////////////////////////////////////////////////////////////////////////////// */
      .coa-table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed; 
        font-size: 10pt;
      }

      .coa-table th,
      .coa-table td {
        border: 1px solid #333;
        padding: 4px;
        text-align: left;
        word-wrap: break-word; /* Prevents overflow */
        
      }

      .coa-table th {
        font-weight: bold;
      }

      /* ///////////////////////////////////////////////////////////////////////////// */
      .footer-table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        font-size: 10pt;
      }

      .footer-table th,
      .footer-table td {
        border: 1px solid #333;
        padding: 3px;
        word-wrap: break-word;
        
      }

      .footer-table th {
        font-weight: bold;
      }

      /* ////////////////////////////////////////////////////////////////////////////// */
      .header {
        display: flex;
        height: 8vh;
        justify-content: space-between;
        color: black;
        flex-wrap: wrap;
        font-family: Arial, sans-serif;
        border-top: 1px solid black;
        border-left: 1px solid black;
        border-right: 1px solid black;
      }

      .doc_no,
      .rev_date {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 20%;
        height: 8vh;
        font-weight: bold;
        font-size: 0.95em;
        box-sizing: border-box;
        border-bottom: 1px solid black;

      }

      .supplier {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        width: 60%;
        font-size: 1.70rem;
        box-sizing: border-box;
      }

      .supp_name {
        font-weight: bold;
        font-size: 0.7em;
        align-items: center;
        justify-content: center;
      }

      .supp_add {
        font-size: 0.45em;
        margin-top: 4px;
        justify-content: center;
        align-items: center;
      }

      .title {
        text-align: center;
        font-size: 1.1em;
        font-weight: bold;
        margin-top: 15px;
        font-family: Arial, sans-serif;
        
      }

      .coa_desc {
        border-top: 1px solid black;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        border-left: 1px solid black;
        border-right: 1px solid black;
      }

      .sign{
        text-align: center;
         vertical-align: bottom;
        height: 8vh;
        max-height: 50px;

      }

      /* ////////////////////// PRINT STYLES ////////////////////// */
      @media print {
        @page {
          size: A4 landscape;
          margin: 10mm;
        }

        body {
          margin: 0;
          padding: 0;
        }

        .spec-table {
          font-size: 8pt;
        }

        .spec-table th,
        .spec-table td {
          padding: 6px;
          border: 1px solid #000;
        }

        .coa-table {
          font-size: 9pt;
          page-break-inside: avoid;
        }

        .coa-table th,
        .coa-table td {
          padding: 6px;
          border: 1px solid #000;
        }

        .footer-table {
          font-size: 9pt;
        }

        .footer-table th,
        .footer-table td {
          padding: 6px;
          border: 1px solid #000;
        }

        .header {
          background-color: #fff;
        }

        .doc_no,
        .rev_date,
        .supplier {
          border: none;
        }

        .title {
          font-size: 1em;
          margin-top: 10px;
        }

        /* Force COA container to one page */
        #coa {
          width: 297mm;
          height: 210mm;
          transform: scale(0.8);
          transform-origin: top left;
          overflow: hidden;
          page-break-inside: avoid;
        }

        nav {
          display: none !important;
          margin: 0;
        }
      }
    </style>
  </head>
  <body>
    <div id="coa">
      <div class="header">
        <div class="doc_no">Document no. <%=docDetails.docNo%></div>
        <div class="supplier">
          <div class="supp_name">
            <%=plant_data.plant_name + "-" + plant_data.plant_location%>
          </div>
          <div class="supp_add"><%=plant_data.plant_add%></div>
        </div>
        <div class="rev_date">
          <div class="revdt">Rev. Date <%=docDetails.revNo %></div>
          <div class="revno">Rev. Date <%=docDetails.revDt%></div>
        </div>
        <!-- <div class="rev_date">Rev. Date <%=docDetails.revDt%></div> -->
      </div>
      <div class="coa_desc">
        <p>
          Certificate of analysis of Plastic
          closure:<%=cokeCoaDetailsData.product%>
        </p>
      </div>

      <table class="spec-table">
        <tr>
          <th>Name of Supplier</th>
          <td><%=plant_data.plant_name%></td>
          <th>Supplier Plant</th>
          <td><%=plant_data.plant_location%></td>
        </tr>
        <tr>
          <th>Closure Type</th>
          <td><%=cokeCoaDetailsData.cl_type%></td>
          <th>Resin Grade/Supplier</th>
          <td><%=rmData.rm + "/" + rmData.rm_type + " " +rmData.rm_sup %></td>
        </tr>
        <tr>
          <th>Closure Weight</th>
          <td><%=cokeCoaDetailsData.cl_wt%>gm</td>
          <th>Colorant Detail and Dosage</th>
         <td>
  <%= 
    (mbData && mbData.mb_code && mbData.mb_code !== 'N/A') 
      ? `${mbData.mb_code} ${mbData.mb_colour && mbData.mb_colour !== 'N/A' ? '(' + mbData.mb_colour + ')' : ''} ${mbData.mb_dosage && mbData.mb_dosage !== 'N/A' ? mbData.mb_dosage + '%' : ''}` 
      : 'N/A' 
  %>
</td>


        </tr>
        <tr>
          <th>Closure Drawing No</th>
          <td><%=cokeCoaDetailsData.cl_drw%></td>
          <th>Invoice No.</th>
          <td><%=more_info.inv_no%></td>
        </tr>
        <tr>
          <th>Closure Finish Type</th>
          <td><%=cokeCoaDetailsData.cl_fn_ty%></td>
          <th>Invoice Quantity</th>
          <td>
            <%=more_info.qty * specData.packing_qty %> nos. (<%=more_info.qty%>
            boxes)
          </td>
        </tr>
        <tr>
          <th>Batch/Lot No</th>
          <td><%=batch_data.batch_number%></td>
          <th>Date of Invoice</th>
          <td><%=more_info.inv_dt%></td>
        </tr>
        <tr>
          <th>Customer</th>
          <td>            
            <%=customer_data.customer_name%>
            <input type="text" value="<%=customer_data.customer_location%>">
          </td>`
          <th>Color</th>
          <td><%=mbData.mb_colour%></td>
        </tr>
        <tr>
          <th>Closure Size & Type</th>
          <td><input style="width: 100%;" type="text" value="<%=cokeCoaDetailsData.cl_size_ty%>"></td>
          <th>Debossed</th>
          <td><%=batch_data.debossed%></td>
        </tr>
        <tr>
          <th>Liner Material (if applicable)</th>
          <td>NO</td>
          <th>MFD</th>
          <td><%=more_info.mfd%></td>
        </tr>
        <tr>
          <th>Internal Print (if applicable)</th>
          <td>No</td>
          <th>Date of Expiry</th>
          <td>One year from date of manufacturing</td>
        </tr>
      </table>

      <div class="dimension">
        <table class="coa-table">
          <thead>
            <tr>
              <th>Characteristic</th>
              <th>Specs</th>
              <th>Minimum (mm)</th>
              <th>Maximum (mm)</th>
              <th>Average (Min. 25 Closures)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Visual</td>
              <td>Ok</td>
              <td>Ok</td>
              <td>Ok</td>
              <td>Ok</td>
            </tr>
            <tr>
              <td>Knurling</td>
              <td>
                <%= cokeCoaDetailsData.cl_kn + "±" +
                cokeCoaDetailsData.cl_kn_tol %>
              </td>
              <td>
                <input
                  type="text"
                  value="<%= avgData && avgData.minkn ? avgData.minkn.toFixed(2) : ''%>"
                />
              </td>
              <td>
                <input
                  type="text"
                  value="<%= avgData && avgData.maxkn ? avgData.maxkn.toFixed(2) : ''%>"
                />
              </td>
              <td>
                <input
                  type="text"
                  value="<%= avgData && avgData.avgkn ? avgData.avgkn.toFixed(2) : ''%>"
                />
              </td>
            </tr>
            <tr>
              <td>Liner Weight (if applicable)</td>
              <td><%= cokeCoaDetailsData.cl_liner_wt %></td>
              <td><%= cokeCoaDetailsData.cl_liner_wt %></td>
              <td><%= cokeCoaDetailsData.cl_liner_wt %></td>
              <td><%= cokeCoaDetailsData.cl_liner_wt %></td>
            </tr>
            <tr>
              <td>Closure Height</td>
              <td>
                <%= cokeCoaDetailsData.cl_ht + "±" +
                cokeCoaDetailsData.cl_ht_tol %>
              </td>
              <td>
                <input
                  type="text"
                  value="<%= avgData && avgData.minht ? avgData.minht.toFixed(2) : '' %>"
                />
              </td>
              <td>
                <input
                  type="text"
                  value="<%= avgData && avgData.maxht ? avgData.maxht.toFixed(2) : '' %>"
                />
              </td>
              <td>
                <input
                  type="text"
                  name=""
                  id=""
                  value="<%= avgData && avgData.avght ? avgData.avght.toFixed(2) : '' %>"
                />
              </td>
            </tr>
            <tr>
              <td>Closure Weight</td>
              <td>
                <%= cokeCoaDetailsData.cl_wt + "±" +
                cokeCoaDetailsData.cl_wt_tol %>
              </td>
              <td>
                <input
                  type="text"
                  value="<%= avgData && avgData.minwt ? avgData.minwt.toFixed(2) : '' %>"
                />
              </td>
              <td>
                <input
                  type="text"
                  value="<%= avgData && avgData.maxwt ? avgData.maxwt.toFixed(2) : '' %>"
                />
              </td>
              <td>
                <input
                  type="text"
                  value="<%= avgData && avgData.avgwt ? avgData.avgwt.toFixed(2) : '' %>"
                />
              </td>
            </tr>
            <tr>
              <td>SST</td>
              <td colspan="4"><%= cokeCoaDetailsData.cl_sst %></td>
            </tr>
          </tbody>
        </table>
        <div class="desc">
          <p>
          Certified that the above consignment of closures meets the standards
          and specifications as per the INSWA BU Packaging Specifications.
          Certified that the above consignment of closure fulfill requirements
          Food Safety standard for Packaging regulations,provided by FSSAI.
        </p>
        <p>
          All packaging materials and Pallets used are clean and free from any
          of or obnoxious odors
        </p>
        </div>
        <table class="footer-table">
          <tr>
            <th class="sign" colspan="2">Inspected by (QAE)</th>
            <th class="sign" colspan="2">Approved by (QAM)</th>
          </tr>
          <tr>
            <th class="fdata">Issue Date</th>
            <td class="fdata">16th April, 2023</td>
            <th class="fdata">Document No.</th>
            <td class="fdata">IND-BU-RQ-140-SP-03 - Closure-Rev 11</td>
          </tr>
          <tr>
            <th class="fdata">Revision Date</th>
            <td class="fdata">15 January, 2022</td>
            <th class="fdata">Page</th>
            <td class="fdata">17 of 17</td>
          </tr>
        </table>
      </div>
    </div>
    <button
      id="downloadPDF"
      class="bg-blue-500 text-white px-4 py-2 rounded shadow-lg fixed bottom-4 right-4 z-50"
    >
      Download PDF
    </button>
    <button
      id=""
      class="bg-blue-500 text-white px-4 py-2 rounded shadow-lg fixed bottom-4 left4 z-50"
    >
      <a href="/">Home</a>
    </button>

    <!-- html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
      document.getElementById("downloadPDF").addEventListener("click", () => {
        // Dynamic filename
        const inv_no = "<%= more_info.inv_no %>";
        const batch_no = "<%= batch_data.batch_number %>";
        const design = "<%= cokeCoaDetailsData.design %>";
        const colour = "<%= mbData.mb_colour %>";
        const debossed = "<%= batch_data.debossed %>";
        const customerName = "<%=customer_data.customer_name%>"
        const customerLocation = "<%=customer_data.customer_location%>"

        const filename = `${inv_no}_${batch_no}_${design}_${customerName}_${customerLocation}_${colour}_${debossed}.pdf`;

        const element = document.getElementById("coa");

        const opt = {
          filename: filename,
          image: { type: "jpeg", quality: 0.98 },
          html2canvas: { scale: 2, useCORS: false },
          jsPDF: { unit: "mm", format: "a4", orientation: "landscape" },
        };

        // Generate and save in landscape (fits automatically)
        html2pdf().set(opt).from(element).save();
      });
    </script>
  </body>
</html>
